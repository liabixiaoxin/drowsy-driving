<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Drowsy-driving by Pantsworth</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen"> 
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
     <link rel="stylesheet" href="stylesheets/animate.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/index.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Drowsy-Driving</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/Pantsworth/drowsy-driving" class="btn">View on GitHub</a>
      <a href="https://github.com/Pantsworth/drowsy-driving/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Pantsworth/drowsy-driving/tarball/master" class="btn">Download .tar.gz</a>
      <a href="img/drowsy_driving.pdf" class="btn">Download our final paper</a>
    </section>

    <section class="main-content">
      <div class="jumbotron fadeInDown animated content_even">
        <div class="row">
          <!-- <div class="container"> -->
            <div class="video col-md-5">

              <iframe width="450" height="315" src="https://www.youtube.com/embed/adgXvC8Ppo8" frameborder="0" allowfullscreen='1'></iframe>

            </div>

            <div class="video-text col-md-6 col-md-offset-1">
              <p>Drowsy Driving is a widespread problem in the United States. It is a known cause of thousands of crashes and fatal accidents every year. Yet, there are few solutions in the market ready to be portable and adaptable to a wide arrang of consumers. This is due to the fact that identifying drowsiness and acting on it is a very challenging task.  </p>
              <p>Our App presents a novel mobile solution in order to identify drowsiness and keep drowsy drivers awake through hands-free interaction with the driver. </p>
              
            </div>
          <!-- </div> -->
        </div>  <!-- row -->  
      </div>



      <div class="jumbotron fadeInDown animated content_odd">
         <h2 >Drowsy Driving Detection Algorithm</h2>
        <div class="row">
          <!-- <div class="container"> -->
            <div class="video col-md-6">

              <img src="img/index.png" alt="flowchart" class="chart">

            </div>

            <div class="video-text col-md-6 ">
              <object data="img/drowsy_driving.pdf" type="application/pdf" view= "Fit">
               
                <p>you can <a href="img/drowsy_driving.pdf">click here to
                download the PDF file.</a></p>
                
              </object> 
            </div>
          <!-- </div> -->
        </div>  <!-- row -->  
      </div>
      


      <div class="jumbotron fadeInDown animated content_even result">
        <h2 >Methodology and Results</h2>
          

      <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        
        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="headingOne">
            <h4 class="panel-title">
              <a class="collapsed"role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                Drowsiness Detection
              </a>
            </h4>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
            <div class="panel-body">
              <ul>
                <li>Successful blink/yawn detection (subject to proper lighting and forward facing).</li>
                <li>Limitation: Proper lighting and forward facing is need.</li>
                <li>Image Analysis Theory 
                  <div id="li-text">
                    <p>We proposed a  drowsiness detection algorithm by making use of a variety of classification techniques in order to create a more robust and accurate classifier. Some previous work does not solve the problem by identifying drowsiness, but rather by identifying one of the features of drowsiness such as a closed eye. We chose to focus on 3 features and built a classification algorithm based on these features: </p>

                      <ul>
                        <li>Blink rate (blinks per minute)</li>

                        <li>Yawn rate (yawns per minute)</li>

                        <li> Blink length (moving average length of previous yawns</li>
                      </ul>

                      <p>In order to calculate these features, we designed an algorithm that will make use of image recognition analysis in order to detect the face, eyes, and mouth in every frame. Afterwards, information from subsequent frames is fed into the algorithm in order to extract the required features.</p>
                      <p>The flowchart in Figure 1 describes the process to detect drowsiness. The algorithm is attempted with each camera frame, and a different algorithm (discussed later in the section) determines the level of drowsiness. <img src="img/flowchart.jpg" alt="flowchart" width="502"  align="right" margin-right = "-200px"> </p>

                      <h4>Face Detection</h4>
                      <p>The first step of the drowsiness detection algorithm is face detection. Since our approach requires image analysis and recognition in each frame, performance is a necessary attribute. Viola and Jones's algorithm for real-time face detection was deemed appropriate. The algorithm works on the basis of classification based on simple features rather than pixels directly.</p>
                           
                      <p> In order to decrease the time to process the image, a cascade of weak classifiers is built. Each weak classifier is not able to individually classify the image, but the combination of classifiers is able to discern the correct object. </p>

                      <p>The implementation of this classifier was used by means of the Python OpenCV 2.4 library, which is optimized to work as a wrapper for the OpenCV C++ functions, and thus provides a performance similar in its bare-bones Python library as in the C++ implementation. We decided to use the Python version for simplicity of code and development speed.</p>

                      <h4>Eye Detection</h4>
                     <p>The implementation of this classifier was used by means of the Python OpenCV 2.4 library </p>
                     <p>The eye detection algorithm uses a very similar approach to the cascade-based classification that identifies a face. Nevertheless, an eye is harder to recognize and thus easier to miss-classify. As a result, the bounding window on which the eye was searched for was significantly decreased in an effort to achieve higher accuracy and  performance.</p>
                     <p>For an identified face starting at coordinates (x,y) and with a width of $w$ and a height of h, the face image can be represented as the following:</p>
                      <ul style="list-style-type:none"> 
                        <li><i>face = Image[y:y+h,x:x+w]</i></li>
                      </ul>
                      
                     <p> Where Image is the captured frame with a camera. The bounding box for the eye is as following:</p>
                      <ul style="list-style-type:none"> 
                        <li><i>eye = Image[(y+h/5):(y+h/2),x:(x+w)]</i></li>
                      </ul>
                      <p>Additionally, it should be noted that the cascade classifier can and will find one or two eyes depending on the lighting conditions, camera positioning, and other factors. Since blinking mostly occurs with both eyes simultaneously, we considered only the cases when we <b>1) detected open eyes and 2) did not detect eyes</b></p>

                      <h4>Eye Blink Detection</h4>
                      <p>The algorithm proposed to detect the blink rate and blink length is an implementation of a finite state machine which feeds its result to a historic data array, a portion of which is then analyzed and sent to the back-end storage. A discussion of the finite state machine follows:</p>
                      <p id = "blink-side-text">The Finite state machine can be seen in Figure 2. Its operation spans a minimum of 3 frames, 2 to detect a blink and 3 to also detect the length of the blink. Using the Python time library allows reliable measurement of blink length without the need to account for different fps performance in the algorithm. After a blink is detected and its time and length calculated, that information is saved in two separate arrays. The array containing information about the start time of a blink is used to determine blink ratio (blinks per minute) whereas the blink length array is used to determine the average blink length.
                      The features used in the classification algorithm are as follows:
                       <img id = "finite"src="img/finite.png" alt="finite machine" align="right"> 
                      <ul style="list-style-type:none"> 
                        <li><i>Blink start time ==> Append to array of blink start times [b_0, b_1, b_2...]</i></li>
                        <li><i>Blink length ==> Append to array of blink lengths [l_0,l_1,l_2,...]</i></li>
                      </ul>
                    </p>
                      
      

                      <h4>Yawn Detection:</h4>
                      <p>The Yawn detection algorithm is very similar as the blink detection algorithm. The mouth detection proved to be less robust and more prone to misses, and thus we decided to have a threshold of minimum 5 continuous non-mouth frames to determine that a yawn was executed. Other considerations were taken into account to determine a yawn since there were many false positives while testing. False positives were triggered for anything from a person looking away, talking loudly, or placing a hand in front of the mouth. Further work on yawn detection could provide a more reliable drowsiness detection algorithm. </p>


                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="headingTwo">
            <h4 class="panel-title">
              <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                Data Communication
              </a>
            </h4>
          </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
            <div class="panel-body">
              <ul>
                <li>Implementation of Detector => Cloud => Android App</li>
                <li>Data is being constantly updated, every 20 seconds. In addition, requests from the Android App are generated at a period shorter than 5 seconds. </li>
                <li>The Cloud hosting and computation environment used is Cloud 9. This system allows us to set up a LAMP stack and manage a vm as a local machine. </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="panel panel-default well-1">
          <div class="panel-heading" role="tab" id="headingThree">
            <h4 class="panel-title">
              <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                 Threshold Calculation
              </a>
            </h4>
          </div>
          <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
            <div class="panel-body">
              <div class="row">
                <div class="col-md-7 ">
                  <p class = "treshold-text">In order to determine whether the driver is sleepy or not, we collected samples from 20 individuals. To establish ground truth, we used a small questionnaire previous to the study and in addition, considered the time of day.</p>
                  <p class = "treshold-text">A classifier was trained using approximately 150 negative data points and 100 positive data points from these 20 individuals. The machine-learning tool Weka allows to compare multiple classification algorithms with the given data without having to code the algorithms.</p>
                </div>
                <div class="col-md-4 col-md-offset-1">
                  <div class="row"><img class="blink-img" src="img/blinkRate.png" alt="Blink Rate histogram (red=sleepy) ">
                    <br>  Blink Rate Histogram (red=sleepy)</div>
                  <div class="row"><img class="blink-img" src="img/yawnRate.png" alt="Yawn Rate histogram (red=sleepy)">
                    <br>  Yawn Rate Histogram (red=sleepy)
                  </div>
                </div>
            </div>     
        </div>
      </div>
    </div>

       <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="headingFour">
            <h4 class="panel-title">
              <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                Raspberry Pi
              </a>
            </h4>
          </div>
          <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
            <div class="panel-body">
              <div class="row">
                <div class="col-md-5 col-md-offset-1">
                <img id="pi-img" src="img/raspberrypi.png" alt="Raspberry-pi">
                  <!-- <br>Raspberry-pi record driver's face imange, analyse  -->
                </div>
                <div class="col-md-6 pi-text">
                <p> The algorithm we developed was fast enough to work seamlessly on any relatively new desktop or laptop computer. Nevertheless, when we tried using the Raspberry Pi, we initially got a performance of 2-3 fps. After implementing optimizations mentioned in the research paper, we achieved a sampling ratio of 5 fps.</p>
                 <p>Here, a new problem comes up. As stated in the Drowsiness Detection section, we need 3 frames in order to correctly measure a blink. 3 frames at 5fps = 0.6 seconds. An average human blink takes between 0.1 and 0.4 seconds. Thus, the current design is not a feasible design for the Raspberry Pi. Further optimizations and using the new Raspberry Pi 3 could fix this issue. 
                 </p>
                </div>
              </div>     
            </div>
           </div>
      </div>

      <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="headingFive">
            <h4 class="panel-title">
              <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                Android Application
              </a>
            </h4>
          </div>
          <div id="collapseFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive">
            <div class="panel-body">
               <div class="row newspaper">

           <div class="polaroid col-md-3">
            <img src="img/dd.jpg" alt="data page" style="width:100%">
            <div class="container ui-text ui-text1">
            <p  >Drowsy Driving</p>
           </div>
          </div> 

       
          <div class="polaroid col-md-3">
            <img src="img/dispayData.jpg" alt="data page" style="width:100%">
            <div class="container ui-text ui-text3">
            <p>Display Data</p>
            </div>
          </div>

          <div class="polaroid col-md-3">
            <img src="img/voice_alert.jpg" alt="data page" style="width:100%">
            <div class="container ui-text ui-text2">
            <p>Alert Driver</p>
           </div>
          </div>

          <div class="polaroid col-md-3">
            <img src="img/googleMap.jpg" alt="data page" style="width:100%">
            <div class="container ui-text ui-text4">
            <p>Open Google Maps</p>
           </div>
         </div>
        </div>
            </div>
          </div>
        </div>

 </div>
  </div>

      <div class="jumbotron fadeInDown animated content_odd">
       <h2>How does this work?</h2> 
       <div class="row">
        <div class="ppt col-md-5"><img src="img/how.png" alt="How Drowsy-Driving Works"></div>
        <div class="text_intro col-md-7">
          <ul>
            <li>Mounted camera records the image of driver while driving.</li>
            <li>Raspberry Pi does image analysis and determines driver's level of drowsiness</li>
            <li>Raspberry Pi uploads information to a cloud database</li>
            <li>Android App pulls data from database.</li>
            <li>App interacts with the driver when drowsiness is detected and attempts to provide a solution</li>
          </ul>

        </div>
        </div>


        <div class="row newspaper">

           <div class="polaroid col-md-3">
            <div class="bc">
            <img src="img/dd.jpg" alt="data page" style="height:130px;padding-left:33% ; padding-right: 40%;">
            </div>
            <div class="container ui-text ui-text1">
            <p  >Android Application</p>
           </div>
          </div> 

            <div class="polaroid col-md-3">
            <img src="img/data.png" alt="data page" style="width:100%">
            <div class="container ui-text ui-text2">
            <p>Display Data</p>
           </div>
          </div>
       
          <div class="polaroid col-md-3">
            <img src="img/speak.png" alt="data page" style="width:100%">
            <div class="container ui-text ui-text3">
            <p>Alert Driver</p>
            </div>
          </div>

          <div class="polaroid col-md-3">
            <img src="img/map.png" alt="data page" style="width:100%">
            <div class="container ui-text ui-text4">
            <p>Redirect to Google Map</p>
           </div>
         </div>
        </div>

      </div>  



      
      <div class="jumbotron fadeInDown animated content_even">
       <h2>What factors did we look at?</h2> 
       <!-- <h4> Image Analysis</h4> -->
        <div class="row well well1">
          <div class="col-md-2"><img src="img/eye_icon.png" alt="eye icon" id= "eye-icon"></div>
          <div class="col-md-10 well-text ">Blink rate and length detection</div>
        </div>
        
        <div class="row well well2">
          <div class="col-md-2"><img src="img/yawn.png" alt="eye icon" id= "eye-icon"></div>
          <div class="col-md-10 well-text ">Yawn rate detection  </div>
        </div>
        <div class="row well well3">
          <div class="col-md-2"><img src="img/glasses.png" alt="eye icon" id= "eye-icon"></div>
          <div class="col-md-10 well-text">System performance when someone wears glasses or a clear vision is otherwise obstructed  </div>
        </div>
         <div class="row well well4">
          <div class="col-md-2"><img src="img/hand.png" alt="eye icon" id= "eye-icon"></div>
          <div class="col-md-10 well-text">Interactivity methods and providing a real solution  </div>
        </div>


      </div>  




      <div class="jumbotron fadeInDown animated survey content_odd">
        <h2> How do you like the app?</h2>
        <div class="survey">
          <form action="">
          <lable >How do you like "Drowsy Driving"?</lable>
          <ul class='likert'>
      <li>
        <input type="radio" class = "submit1" name="likert3" value="strong_agree">
        <label>Awsome</label>
      </li>
      <li>
        <input type="radio" class = "submit1" name="likert3" value="strong_agree">
        <label>A Lot</label>
      </li>
      <li>
        <input type="radio" class = "submit1" name="likert3" value="strong_agree">
        <label>Good</label>
      </li>
      <li>
        <input type="radio" class = "submit1" name="likert3" value="strong_agree">
        <label>Fine</label>
      </li>
      <li>
        <input type="radio" class = "submit1" name="likert3" value="strong_agree">
        <label>I hate it!</label>
      </li>
      
    </ul>

  

          <lable>What do you think should be changed?</lable>
          <ul class='likert  '>
      <li>
        <input type="radio" class = "submit2" name="likert1" value="strong_agree">
        <label>App Style</label>
      </li>
      <li>
        <input type="radio" class = "submit2" name="likert1" value="strong_agree">
        <label>Alert Sound</label>
      </li>
      <li>
        <input type="radio" class = "submit2" name="likert1" value="strong_agree">
        <label>Maps integration</label>
      </li>
      <li>
        <input type="radio" class = "submit2" name="likert1" value="strong_agree">
        <label>Data Accuracy</label>
      </li>
      <li>
        <input type="radio" class = "submit1" name="likert1" value="strong_agree">
        <label>I don't know!</label>
      </li>
      
    </ul>
  
          <lable>What do you like the most of this?</lable>
          <ul class='likert '>
      <li>
        <input type="radio" class = "submit3" name="likert2" value="strong_agree">
        <label>App Style</label>
      </li>
      <li>
        <input type="radio" class = "submit3" name="likert2" value="strong_agree">
        <label>Alert Sound</label>
      </li>
      <li>
        <input type="radio" class = "submit3" name="likert2" value="strong_agree">
        <label>Maps integration</label>
      </li>
      <li>
        <input type="radio" class = "submit3" name="likert2" value="strong_agree">
        <label>Data Accuracy</label>
      </li>
      <li>
        <input type="radio" class = "submit3" name="likert" value="strong_agree">
        <label>I don't know!</label>
      </li>
      
    </ul>
  
    <div class="buttons">
        <p class="submit-fail"> </p> <!-- alert pople to answer all the questions when they didn't -->
        <button class="submit">Submit</button>
    </div>
  
    </div>
      </form>
      </div>
      
       <div class="jumbotron fadeInDown animated team-intro content_even bc6">
        <h2>Who are we?</h2>
        <div class="row">
          <div class="people col-md-3">
            <div class="thumbnail">
              <img  class = "people_img"  src="img/b.jpg" alt="Bruno">
              <p class="name">Bruno Peynetti</p >
              <div class="caption people_intro">Bruno is a Computer Engineering BS/MS student at Northwestern. Worked on implementing blink detection, multithreading,buiding up database, overall system design, as well as leading the research paper for the project.</div>
            </div>
          </div>
        
        <div class="people col-md-3">
            <div class="thumbnail">
              <img class = "people_img" src="img/m.jpg" alt="Micheal">
              <p class="name">Michael Nowakowski</p > 
              <div class="caption people_intro">Michael is a senior Computer Science/Film double major at Northwestern. Worked on  implementing yawn detection, multithreading, and overall system design, as well as creating the video that summarizes the project.  </div>
            </div>
        </div>
        <div class="people col-md-3">
            <div class="thumbnail">
              <img  class = "people_img"  src="img/yang.jpg" alt="Baiyu">
              <p class="name">Baiyu Yang</p >
              <div class="caption people_intro">Baiyu is a EE master student at Northwestern. Worked on developing Android smartphone Application and making website for presenting the project.</div>
            </div>
        </div> 
        <div class="people col-md-3">
            <div class="thumbnail">
              <img  class = "people_img"  src="img/yannan.jpg" alt="Yannan">
                <p class="name">Yannan Xu</p >
              <div class="caption people_intro">Yannan, graduate student in Electrical Engineering at Northwestern University. Involved in app development, implemented the speech recognition function of the app.
</div>
            </div>
        </div>
        
       </div>

     </div>   

      <div class="jumbotron fadeInDown animated content_odd">
        <h2>NOTE</h2>
        <h4>PROJECT FOR EECS 395/495: Wireless and Mobile Health</h4>

        <p>Drowsy Driving is an Android mobile phone App devoted to detecting driver's drowsiness and keep driver awake.</p>
        <p>Recognizing drowsy driving through yawn and blink detection in a car-mounted webcam system powered by a Raspberry Pi.</p>
          <hr>
        <q>Many thanks to Shantnu Tiwari for this starter code:
        <a href="https://github.com/shantnu/FaceDetect">https://github.com/shantnu/FaceDetect</a>
        and a great tutorial:
        <a href="https://realpython.com/blog/python/face-recognition-with-python/">https://realpython.com/blog/python/face-recognition-with-python/</a></q>
      </div>



      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Pantsworth/drowsy-driving">Drowsy-driving</a> is maintained by <a href="https://github.com/Pantsworth">Pantsworth</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/index.js"></script>
  </body>
</html>
